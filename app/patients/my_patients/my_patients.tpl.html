<div>
    <div class="page">
        <div class="page-top">
            <div class="page-top-buttons">
                <button class="btn btn-action" ng-click="showCreatePatient()"><i class="icon icon-plus-sign"></i> New Patient</button>
            </div>

            <h1>My Patients</h1>
        </div>
        <div class="nodata" ng-show="!patients.length">
            No patients recorded.
        </div>
        <table class="table" ng-show="patients.length">
            <tr>
                <th>Patient</th>
                <th>Diagnoses</th>
                <th>Share</th>
                <th></th>
            </tr>
            <tbody ng-repeat="patient in patients | orderBy:predicate:reverse" cm-resource="patient">
            <tr ng-show="$isEditing">
                <td colspan="5">
                    <div class="resource-block">

                        <div class="resource-block-element clearfix">
                            <label for="type_name" class="label-right">
                                <input type="radio" name="type" value="name" id="type_name" ng-model="patient.name_type">
                                Use Name
                            </label>

                            <label for="type_alias" class="label-right">
                                <input type="radio" name="type" value="alias" id="type_alias" ng-model="patient.name_type">
                                Use Alias
                            </label>
                        </div>

                        <div ng-switch on="patient.name_type">
                            <div ng-switch-when="name">
                                <div class="resource-block-element">
                                    <label for="first_name" class="resource-block-heading label-top">First Name</label>
                                    <input type="text" id="first_name" placeholder="What's their first name?" ng-model="patient.first_name"/>
                                </div>
                                <div>
                                    <label for="last_name" class="resource-block-heading label-top">Last Name</label>
                                    <input type="text" id="last_name" placeholder="What's their last name?" ng-model="patient.last_name"/>
                                </div>
                            </div>
                            <div ng-switch-when="alias">
                                <label for="alias" class="resource-block-heading label-top" >Alias</label>
                                <input type="text" id="alias" placeholder="What is the patient's alias?" ng-model="patient.alias"/>
                            </div>
                        </div>
                    </div>
                    <div class="resource-block">
                        <cm-save-cancel></cm-save-cancel>
                    </div>
                </td>
            </tr>
            <tr ng-show="!$isEditing">

                <td>
                    <a href="#/patient/{{ patient.id }}/summary" class="highlight">
                        {{ patient.name }}
                    </a>
                </td>

                <td>
                    <a href="#/patient/{{ patient.id }}/diagnoses"
                       class="" ng-show="patient.diagnoses.length > 0">
                        {{ patient.diagnoses[0].disorder.name }}
                    </a>
                    <a href="#/patient/{{ patient.id }}/diagnoses" ng-show="patient.diagnoses.length > 1"
                       class="">
                            + {{ patient.diagnoses.length - 1 }} more
                    </a>

                    <a ng-show="!patient.diagnoses.length" href="#/patient/{{ patient.id }}/diagnoses" class="nodata">
                        No diagnosis
                    </a>
                </td>

                <td>
                    <a href="#/patient/{{ patient.id }}/contact-information?sub=share" class="" ng-show="patient.shares.length > 0">
                        {{ patient.shares[0].name }}
                    </a>

                    <a href="#/patient/{{ patient.id }}/contact-information?sub=share" ng-show="patient.shares.length > 1" class="">
                        + {{ patient.shares.length - 1 }} more
                    </a>
                    <a href="#/patient/{{ patient.id }}/contact-information?sub=share" ng-show="!patient.shares.length" class="nodata">
                        No shares
                    </a>
                </td>

                <td>
                    <div class="btn-group pull-right">
                        <button type="button" class="btn btn-action btn-action-small dropdown-toggle" data-toggle="dropdown">
                            <i class="icon icon-angle-down"></i>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="" ng-click="showSharePatient(patient)"><i class="icon icon-share-alt"></i> Share</a></li>
                            <li><a href="" ng-click="showDeletePatient(patient)"><i class="icon icon-trash"></i> Delete</a></li>
                            <!--<li class="divider"></li>-->
                            <!--<li><a href="#">Separated link</a></li>-->
                        </ul>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <button class="btn btn-more" ng-click="loadMore()" ng-show="isMoreToLoad">
            Load More
        </button>
    </div>

    <smodal name="autosharing">

        <div class="smodal-title">
            Autosharing
        </div>
        <div class="smodal-description" >
            Autosharing allows you to <b>automatically share new patient</b> you add with selected groups.<br/>
        </div>
        <div class="smodal-content">
            <table class="sform">
                <tr class="sform-row">
                    <td class="sform-label">
                        <label>Share</label>
                    </td>
                    <td>
                        <div class="sform-inputs">
                            <typeahead multi="true" model="autosharing.groups" options-fn="findGroup(value)" placeholder="What groups do you want to share new patients with?"></typeahead>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="smodal-buttons">
            <div class="pull-right">
                <button class="btn btn-action" ng-click="$close()">Cancel</button>
                <button class="btn btn-action btn-action-selected">Share</button>
            </div>
        </div>
    </smodal>

    <smodal name="deletePatient">
        <div class="smodal-title smodal-block">
            Delete Patient
        </div>
        <div class="smodal-block" >
            Are you sure you want to delete this patient?
        </div>
        <div class="smodal-block">
            <div class="pull-right">
                <button class="btn btn-action" ng-click="$close()">Cancel</button>
                <button class="btn btn-action btn-action-selected" ng-click="$close(); deletePatient(patientToDelete)">Delete #{{ patientToDelete.id}} {{ patientToDelete.first_name }} {{ patientToDelete.last_name }} {{ patientToDelete.alias }}</button>
            </div>
        </div>
    </smodal>

    <smodal name="sharePatient">
        <div class="smodal-title smodal-block">
            Share Patient
        </div>
        <div class="smodal-content smodal-block">
            <div class="smodal-block-element">
                <label class="label-top">Groups</label>
                <typeahead multi="true" model="$parent.patientSharing.groups" options-fn="findGroup(value)" placeholder="What groups do you want to share the patient with?"></typeahead>
            </div>
        </div>
        <div class="smodal-buttons smodal-block">
            <div class="pull-right">
                <button class="btn btn-action" ng-click="$close()">Cancel</button>
                <button class="btn btn-action btn-action-selected" ng-click="$close(); sharePatientWithGroups($parent.patientSharing.patient, $parent.patientSharing.groups)">Share</button>
            </div>
        </div>
    </smodal>


    <smodal name="createPatient">

        <div class="smodal-title smodal-block">
            Create a Patient
        </div>

        <div class="smodal-block">
            <label class="label-top">Type</label>
            <div class="smodal-block-element clearfix">
                <label for="type_name" class="label-right">
                    <input type="radio" name="type" value="name" ng-model="newPatient.name_type">
                    Use Name
                </label>

                <label for="type_alias" class="label-right">
                    <input type="radio" name="type" value="alias" ng-model="newPatient.name_type">
                    Use Alias
                </label>
            </div>

            <div class="smodal-block-element" ng-show="newPatient.name_type == 'name'">
                <label for="first_name" class="smodal-block-heading label-top">First Name</label>
                <input type="text" id="first_name" placeholder="What's their first name?" ng-model="newPatient.first_name"/>
            </div>
            <div class="smodal-block-element" ng-show="newPatient.name_type == 'name'">
                <label for="last_name" class="smodal-block-heading label-top">Last Name</label>
                <input type="text" id="last_name" placeholder="What's their last name?" ng-model="newPatient.last_name"/>
            </div>
            <div class="smodal-block-element" ng-show="newPatient.name_type == 'alias'">
                <label for="alias" class="smodal-block-heading label-top" >Alias</label>
                <input type="text" id="alias" placeholder="What is the patient's alias?" ng-model="newPatient.alias"/>
            </div>
        </div>

        <div class="smodal-buttons smodal-block">
            <div class="pull-right">
                <button class="btn btn-action" ng-click="$close()">Cancel</button>
                <button class="btn btn-action btn-action-selected" ng-click="createPatient(newPatient)">Create</button>
            </div>
        </div>

    </smodal>


</div>
